참고: 모두의 네트워크 - 키즈구치 카츠야 저
위 책을 읽으며 공부한 내용을 정리한 포스트입니다.

---

# 데이터 링크 계층의 역할과 이더넷

## 이더넷이란?

> **데이터 링크 계층**:
> **네트워크 장비 간에 신호를 주고받는 규칙**을 정하는 계층으로, 랜에서 데이터를 정상적으로 주고받기 위해 필요한 계층이다.

데이터 링크 계층은 네트워크 기기 간에 데이터를 전송하고 물리 주소를 결정한다.

> **이더넷**(Ethernet):
>
> 컴퓨터 네트워크 기술 중 하나로, 전 세계의 사무실이나 가정에서 일반적으로 사용되는 랜에서 가장 많이 사용되는 기술 규격이다.
>
> 이더넷은 랜에서 데이터를 정상으로 주고받기 위한 규칙이다.

이더넷은 허브와 같은 장비에 연결된 컴퓨터와 데이터를 주고받을 때 사용한다.

물리 계층에서 언급되었듯, 허브는 들어온 데이터를 그대로 모든 포트에 보낸다.

의도한 대상이 아닌 관계없는 다른 컴퓨터들도 데이터를 받아 내용을 보는 것을 막기 위해 데이터의 내용을 못 보게 하는 규칙이 정해져 있다.  
보내려는 데이터에 **목적지** 정보를 추가해서 보내고, 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하게 되어 있다.

또한, 컴퓨터 여러 대가 동시에 데이터를 보내면 데이터들이 서로 부딪힐 수도 있다. 이것을 **충돌**(collision)이라고 한다.

> **충돌**(collision):
> 데이터를 한 번에 하나만 전송할 수 있는 채널에 전송 장치 두 개가 같은 시점에 패킷을 보낼 때 일어나는 데이터 충돌을 말한다.

그래서 이더넷은 **여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조**로 되어 있다.

이더넷에서는 데이터가 동시에 케이블을 지나가지 않도록 하기 위해, 데이터를 보내는 시점을 늦추는 방식을 사용한다. 이처럼 이더넷에서 시점을 늦추는 방법은 CSMA/CD라고 한다.

> **CSMA/CD**:
> **C**arrier **S**ense **M**ultiple **A**ccess with **C**ollision **D**etection  
> (반송파 감지 다중 접속 및 충돌 탐지)

- **CS**: 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 아닌지를 확인한다는 규칙.
- **MA**: 케이블에 데이터가 흐르고 있지 않다면 데이터를 보내도 좋다는 규칙
- **CD**: 충돌이 발생하고 있는지를 확인한다는 규칙

<br>

사실,지금은 효율이 좋지 않다는 이유로 CSMA/CD는 거의 사용하지 않는다.

이후에 등장할 **스위치**(switch)라는 네트워크 장비를 사용하면 충돌이 일어나지 않는다.

<br>

---

# MAC 주소의 구조

## MAC 주소란?

랜 카드는 비트열(0과 1)을 전기 신호로 변환한다. 이러한 랜 카드에는 MAC 주소라는 번호가 정해져 있다.  
제조할 때 새겨지기 때문에 **물리 주소**라고도 부르는데, **전 세계에서 유일한 번호**로 할당되어 있다.

> **MAC 주소**(물리 주소):
> **M**edia **A**ccess **C**ontrol Address
>
> 랜에 사용되는 네트워크 모델인 이더넷의 물리적인 주소로, 컴퓨터 네트워크에서 각각의 기기를 구분하기 위해 사용하는 주소다.

MAC 주소는 48비트 숫자로 구성되어 있다.  
앞쪽 24비트는 랜 카드를 만든 제조사 번호고, 뒤쪽 24비트는 제조사가 랜 카드에 붙인 일련번호다.

<br>

![맥 주소 예시](https://images.velog.io/images/gndan4/post/eeccfe2f-cf54-4298-b391-e44442f74352/image.png)

앞의 24비트와 뒤의 24비트 모두 정해진 규칙이 있어서 중복되지 않는 번호가 붙는다.

<br>

OSI 모델이나 TCP/IP 모델에서 각 계층에서 데이터에 **헤더**를 붙인다고 했다.  
OSI 모델에서는 데이터 링크 계층에 해당하고, TCP/IP 모델에서는 네트워크 접속 계층에 해당하는데, 이 계층에서 **이더넷 헤더**와 **트레일러**를 붙인다.

> **이더넷 헤더의 구성**:
> 목적지 MAC 주소(6바이트) + 출발지 MAC 주소(6바이트) + 이더넷 유형(2바이트)

<br>

이더넷 유형(Ethernet type)은 이더넷으로 전송되는 상위 계층 프로토콜의 종류를 나타낸다. 여기는 아래의 표에 나와 있는 프로토콜을 식별하는 16진수 번호가 들어간다.

| 유형 번호 (16진수) |      프로토콜      |
| :----------------: | :----------------: |
|        0800        |        IPv4        |
|        0806        |        ARP         |
|        8035        |        RARP        |
|        814C        | SNMP over Ethernet |
|        86DD        |        IPv6        |

유형 번호를 기억할 필요는 없지만, 유형에 **프로토콜 종류를 식별하는 번호**가 들어간다는 내용은 기억해두자.

<br>

이더넷 헤더 외에, 데이터 뒤에 추가하는 트레일러는 **FCS**(Frame Check Sequence)라고도 한다.  
FCS는 데이터 전송 도중에 오류가 발생하는 지 확인하는 용도로 사용한다.

이처럼 이더넷 헤더와 트레일러가 추가된 데이터를 **프레임**이라고 한다.

### 컴퓨터가 허브를 통해 다른 컴퓨터로 데이터를 보내는 과정

1. 컴퓨터 A는 이더넷 헤더에 데이터의 목적지인 컴퓨터 B의 MAC 주소(**목적지 MAC 주소**)와 자신의 MAC 주소(**출발지 MAC 주소**) 정보를 넣고 데이터를 전송한다.

   - 여기에서 송신 측 컴퓨터인 컴퓨터 A에서 캡슐화가 일어난다. 데이터 링크 계층에서 데이터에 이더넷 헤더와 트레이러를 추가하여 **프레임**을 만드는 것이다.

2. 물리 계층에서 이 프레임 비트열을 **전기 신호**로 변환하여 네트워크를 통해 전송한다.

3. 허브는 컴퓨터 A가 보낸 데이터를 수신한 포트 이외의 모든 포트로 전송한다.

4. 컴퓨터 B 이외의 컴퓨터는 목적지 MAC 주소가 자신의 MAC 주소와 다르기 때문에 **데이터를 파기**한다. 반면, 컴퓨터 B는 자신의 MAC 주소가 컴퓨터 1이 보낸 데이터의 목적지 MAC 주소와 같으므로 데이터를 수신한다.

5. 컴퓨터 B에서는 물리 계층에서 전기 신호로 전송된 데이터를 비트열로 변환하고

6. 데이터 링크 계층에서 이더넷 헤더와 트레일러를 분리한다. (역캡슐화)

<br>

컴퓨터 두 대가 동시에 한 컴퓨터에 데이터를 전송하는 경우도 있을 것이다.  
이런 경우에는 충돌을 방지하기 위해 CSMA/CD 방식이 사용된다.

<br>

---

# 스위치의 구조

## MAC 주소 테이블이란?

> **스위치**(switch, switching hub):
>
> **데이터 링크 계층**에서 동작하고, **레이어 2 스위치** 또는 **스위칭 허브**라고 불린다.
>
> 스위치는 랜을 구성할 때 사용되는 단말기 간 스위칭 기능이 있는 통신망 중계 장치다. 컴퓨터(호스트)에서 특정한 다른 단말기로 패킷을 보낼 수 있는 기능이 있어 통신 효율이 향상된다.

스위치 내부에는 **MAC 주소 테이블**(Mac address table)이라는 것이 있다.  
MAC 주소 테이블은 브리지 테이블(bridge table)이라고도 하는데, 스위치의 **포트 번호**와 해당 포트에 연결되어 있는 컴퓨터의 **MAC 주소**가 등록되는 데이터베이스다.

단지 스위치의 전원을 켠 상태에서는 아직 MAC 주소 테이블에 아무것도 등록되어 있지 않다.  
하지만 컴퓨터에서 **프레임**을 전송하면, MAC 주소 테이블을 확인하고 출발지 MAC 주소가 등록되어 있지 않으면 MAC 주소를 포트와 함께 등록한다.  
이를 **MAC 주소 학습 기능**이라고 한다.

하지만 컴퓨터 A에서 컴퓨터 B에 데이터를 전송한 시점에서는 아직 컴퓨터 B의 목적지 MAC 주소가 MAC 주소 테이블에 저장되어 있지 않아서, 송신포트 이외의 모든 포트에 프레임이 전송되는데 이러한 데이터 전송을 **플러딩**이라고 부른다.

만약 스위치의 MAC 주소 테이블에 이미 컴퓨터 B의 MAC 주소가 등록되어 있다면, 다른 컴퓨터에는 데이터가 전송되지 않고 컴퓨터 B에만 데이터가 전송된다.

이와 같이 MAC 주소를 기준으로 목적지를 선택하는 것을 **MAC 주소 필터링**이라고 한다.  
이로 인해 불필요한 데이터를 네트워크에 전송하지 않게 되는 것이다.

<br>

---

# 데이터가 케이블에서 충돌하지 않는 구조

## 전이중 통신과 반이중 통신

통신 방식에는 전이중 통신과 반이중 통신 방식이 있다.

> **전이중 통신 방식**(full-duplex communication):
>
> 전화 회선과 같이 **송신과 수신이 양쪽에서 동시에** 이루어지는 양방향 통신이다.
>
> 서로 다른 회선이나 주파수를 이용하여 데이터 신호가 충돌되는 상황을 방지한다. 스위층 허브를 사용하면 랜 카드와 허브 간의 동시 송수신이 가능해진다.

> **반이중 통신 방식**(half-duplex communication):
> 전이중 통신 방식과 달리, 회선 하나로 송신과 수신을 **번갈아가면서** 통신하는 방식이다.

전이중 통신 방식은 데이터를 동시에 전송해도 충돌이 발생하지 않지만,  
반이중 통신 방식은 데이터를 동시에 전송하면 **충돌**이 발생한다.

만약 컴퓨터 A와 컴퓨터 B를 직접 랜 케이블(그 중에서도 크로스 케이블)로 연결한다면 **전이중 통신 방식**이 된다.  
(송신: 1, 2번 선) (수신: 3, 6번 선)

반면 허브 내부에는 송수신이 나우어져 있지 않기 때문에 두 컴퓨터를 허블 연결하면 동시에 데이터를 보낼 때 충돌이 일어난다.  
이처럼 허브를 사용하면 회선 하나를 송신과 수신이 번갈아가면서 사용하는 **반이중 통신 방식**을 사용하게 된다.

스위치는 허브와 달리, 내부에서 데이터의 충돌이 일어나지 않는 구조로 되어있기 때문에 **전이중 통신 방식**으로도 데이터를 주고받을 수 있다.

허브를 사용하면 충돌이 생기면서 네트워크 지연이 발생하기 때문에 최근에는 네트워크로 **스위치를 사용하는 것이 표준**이다.

<br>

## 충돌 도메인이란?

> **충돌 도메인**:
> 데이터의 충돌이 발생할 때 그 영향이 미치는 범위

허브의 경우는 충돌이 일어나면, 접속되어 있는 모든 컴퓨터가 충돌 도메인이 된다.

반면 스위치는 데이터를 동시에 송수신할 수 있는 전이중 통신 방식이기 때문에 충돌이 일어나지 않고, 충돌 도메인의 범위도 좁다(해당 컴퓨터)

충돌 도메인의 범위가 넓을수록 네트워크가 지연되기 때문에, 충돌 도메인의 범위를 좁히는 것이 매우 중요하다.

<br>

## ARP

> **ARP** (Address Resolution Protocol): 주소 변환 프로토콜
>
> 네트워크 계층 주소와 데이터 링크 계층 주소 사이의 변환을 담당하는 프로토콜이다.
>
> **목적지 컴퓨터의 IP 주소를 이용하여 MAC 주소를 찾는 데에 사용**한다.
> 이더넷 프레임을 전송하려면 목적지 컴퓨터의 MAC 주소를 지정해야 한다.

출발지 컴퓨터가 목적지 주소를 모르면 MAC 주소를 알아내기 위해 네트워크에 브로드캐스트를 하는데 이것을 **ARP 요청**(request)라고 한다.

> **ARP 요청**:
> IP 주소를 대치할 수 있는 물리 주소인 MAC 주소를 찾아내기 위해 보내는 브로드캐스트 패킷 요청.

이 요청에 대해 지정된 IP 주소를 가지고 있지 않은 컴퓨터는 응답하지 않지만, 지정된 IP 주소를 가진 컴퓨터는 MAC 주소를 응답으로 보낸다.  
이것을 **ARP 응답**(reply)라고 한다. 이것으로 출발지 컴퓨터는 MAC 주소를 얻고 이더넷 프레임을 만들 수 있다.

> **ARP 응답**:
> ARP 요청에 대한 응답으로, 요청한 IP 주소에 대한 물리 주소인 MAC 주소가 실려 있다.

출발지 컴퓨터에서는 MAC 주소를 얻은 후에 MAC 주소와 IP 주소의 매핑 정보를 메모리에 보관한다. 이 정보를 **ARP 테이블**이라고 한다. 이후 데이터 통신은 자신의 컴퓨터에 보관된 ARP 테이블을 참고하여 전송된다.

하지만 IP 주소가 변경되면 해당 MAC 주소도 함께 변경되므로 제대로 통신할 수 없다. 그래서 ARP 테이블에서는 보존 기간을 **ARP 캐시**(cache)로 지정하고, 일정 시간이 지나면 삭제하고 다시 ARP 요청을 한다.

> **ARP 캐시**:
> 가장 최근에 변환한 **IP 대 하드웨어 주소**를 보관하고 있는 램(RAM)의 한 영역이다.

<br>

---

# 이더넷의 종류와 특징

## 이더넷 규격

이더넷은 케이블 종류나 통신 속도에 따라 **다양한 규격**으로 분류된다.

### 주요 이더넷 규격

| 규격 이름  | 통신 속도 |        케이블         | 케이블 최대 길이 | 표준화 연도 |
| :--------: | :-------: | :-------------------: | :--------------: | :---------: |
|  10BASE5   |  10Mpbs   |      동축케이블       |       500m       |   1982년    |
|  10BASE2   |  10Mpbs   |      동축케이블       |       185m       |   1988년    |
|  10BASE-T  |  10Mpbs   | UTP케이블(Cat3 이상)  |       100m       |   1990년    |
| 100BASE-TX |  100Mpbs  | UTP케이블(Cat5 이상)  |       100m       |   1995년    |
| 1000BASE-T | 1000Mpbs  | UTP케이블(Cat5 이상)  |       100m       |   1999년    |
| 10GBASE-T  |  10Gpbs   | UTP케이블(Cat6a 이상) |       100m       |   2006년    |

<br>

### 이더넷 규격의 의미

그림 출처: [IT 내 맘대로 끄적끄적](http://itnovice1.blogspot.com/2019/09/lan-wan-csmacd.html)

<br>

![이더넷 규격의 의미 1](https://images.velog.io/images/gndan4/post/fc69857f-de03-4f1e-b2ee-e8ba72e614d7/image.png)

<br>

![이더넷 규격의 의미 2](https://images.velog.io/images/gndan4/post/855bb0a2-f6db-4d1c-aa2e-a84e14dbd2df/image.png)

그림에서 볼 수 있듯, 첫번째 부분은 **통신 속도**, 두 번째 부분은 BASEBAND라는 **전송 방식**, 그리고 마지막 부분은 **케이블 종류** 또는 **길이**를 나타낸다.

> **BASEBAND**:
> 펄스 신호에 의한 디지털 전송 방식

규격 이름을 보면 전송 방식 다음에 바로 숫자가 붙은 게 있고, 바로 뒤에 알파벳이 붙은 게 있다.

하이픈(-) 뒤는 케이블 길이나 케이블 종류를 나타내지만, 동축케이블은 케이블의 최대 길이를 100미터 단위로 표시한다.  
UTP 케이블의 경우 하이픈 뒤에 케이블 종류를 표시한다.

즉, 동축케이블(전송 방식 바로 뒤 숫자)과  
UTP 케이블(전송 방식 뒤 하이픈 뒤 알파벳)을 표시하는 방법이 다르다.
